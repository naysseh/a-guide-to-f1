<!DOCTYPE html>
<html>

<head>
  <title>A Guide To F1</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>

  <link rel="stylesheet" type="text/css" href="styles/site.css">
</head>


<body>
  <div id="map">
    <div id="mapText">intro text here with description/overview .... im just putting placeholder text for now </div>
    <svg id="map" height="900" width="900"></svg>

  </div>
  

  <script>
    const map = d3.select("svg#map");


    const requestData = async function () {
      const combinedData = await d3.csv("results_dataset.csv", d3.autoType);
      console.log(combinedData);

      const atlasData = await d3.json("world-countries.json");
      console.log(atlasData);

      // This CSV has all the data from every previous circuit, some of which are not currently active but all should have data from the past
      const circuits = await d3.csv("data/circuits.csv", d3.autoType);
      console.log(circuits);


      const mapHeight = map.attr("height");
      const mapWidth = map.attr("width");

      let viewport = map.append("g");
      let countryMesh = topojson.mesh(atlasData, atlasData.objects.countries1);
      let countries = topojson.feature(atlasData, atlasData.objects.countries1);

      var projection = d3.geoMercator().fitSize([mapWidth, mapHeight], countries);
      var path = d3.geoPath().projection(projection);

      viewport.selectAll("path.country")
              .data(countries.features)
              .join("path")
              .attr("class", "country")
              .style("fill", "none")
              .style("stroke", "white")
              .style("stroke-width", ".5px")
              .attr("d", path);

      var zoom = d3.zoom()
                   .scaleExtent([1, 10])
                   .on("zoom", zoomTransform);


     function zoomTransform({transform}) {
       viewport.attr("transform", transform.toString());
     };
     map.call(zoom);

     let circuitDots = viewport.selectAll("circle.circuit")
                               .data(circuits)
                               .join("circle")
                               .attr("class", "circuit")
                               .attr("cx", d => projection([d.lng, d.lat])[0] )
                               .attr("cy", d => projection([d.lng, d.lat])[1] )
                               .attr("r", "3px")
                               .style("fill", "red")
                               .on("click", function (event, d) {
                                console.log(d.name);
                               })
                               .on("mouseover", function (event, d) {
                                d3.select(this)
                                .style("stroke", "white")
                                .style("stroke-width", "1px")
                               })
                               .on("mouseout", function (event, d) {
                                d3.select(this)
                                .style("stroke", "none")
                                .style("stroke-width", "0px")
                               });
                                      

    }
    requestData();
  </script>

</body>
</html>